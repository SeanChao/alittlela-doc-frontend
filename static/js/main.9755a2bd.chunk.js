(this.webpackJsonpladoc=this.webpackJsonpladoc||[]).push([[0],{44:function(e,t,n){},45:function(e,t,n){},77:function(e,t,n){"use strict";n.r(t);var o=n(0),l=n.n(o),c=n(36),r=n.n(c),a=(n(44),n(45),n(22)),s=n(9),i=n(15),u=n(19),d=n.n(u),h=n(37),g=n.n(h),j=null===Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_API_URL?"":Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_API_URL;d.a.defaults.baseURL=j;var b=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=n.auth,l=n.payload,c=n.params,r={method:e,url:t,params:c,data:l};return o&&(window.localStorage?r.headers={Authorization:localStorage.getItem("auth_token")}:r.headers={Authorization:g.a.load("auth_token")}),new Promise((function(e,t){return d()(r).then((function(n){200===n.status?e(n.data):(console.log(n),t(n))})).catch((function(e){t(e)}))}))},f=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return b("get",e,{params:t,auth:n})},w=n(1),O=function(){return Object(w.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:Object(w.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})},m=function(){return Object(w.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:Object(w.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})},v=function(e){var t=e.title,n=e.link,o=e.onDelete,l=Object(i.a)(e,["title","link","onDelete"]);return Object(w.jsxs)("div",Object(s.a)(Object(s.a)({},l),{},{children:[Object(w.jsx)("a",{className:"w-full text-gray-800",href:"/sheet/".concat(n||""),children:Object(w.jsx)("p",{children:t})}),Object(w.jsx)("button",{onClick:o,className:"flex-no-shrink p-2 ml-2 border-2 rounded text-red-300 border-red-300 hover:text-white hover:bg-red-300",children:Object(w.jsx)(O,{})})]}))},p=function(){var e=Object(o.useState)([]),t=Object(a.a)(e,2),n=t[0],l=t[1],c=Object(o.useState)(""),r=Object(a.a)(c,2),s=r[0],i=r[1];Object(o.useEffect)((function(){f("/files").then((function(e){return l(e.files)})).catch((function(e){return console.log(e)}))}),[]);var u=function(e){f("/delete",{path:e})};return Object(w.jsxs)("div",{className:"bg-white rounded shadow w-full lg:w-3/4 lg:max-w-lg",children:[Object(w.jsxs)("div",{className:"mb-4 p-10",children:[Object(w.jsx)("h1",{className:"text-gray-700 text-4xl font-bold",children:"Your Docs"}),Object(w.jsxs)("div",{className:"flex mt-4",children:[Object(w.jsx)("input",{className:"shadow appearance-none border rounded w-full py-2 px-3 mr-4 text-grey-darker",placeholder:"Create a new sheet...",value:s,onChange:function(e){return i(e.target.value)}}),Object(w.jsx)("button",{className:"flex-no-shrink p-2 border-2 rounded text-green-300 border-green-300 hover:text-white hover:bg-green-300",onClick:function(){!function(e){f("/create",{path:e})}(s)},children:Object(w.jsx)(m,{})})]})]}),Object(w.jsx)("div",{className:"divide-y",children:n.map((function(e,t){return Object(w.jsx)(v,{title:e,link:"".concat(e,"/").concat("user".concat(Math.round(1e3*Math.random()))),onDelete:function(){return u(e)},className:"flex pb-4 pt-4 pl-10 pr-10 items-center hover:bg-gray-50"},t)}))})]})},x=function(e,t){return e.data==t.data&&e.myFolderUrl==t.myFolderUrl&&e.title==t.title},k=l.a.memo((function(e){var t=e.options,n=Object(i.a)(e,["options"]);return Object(o.useEffect)((function(){window.luckysheet.create(Object(s.a)({container:"luckysheet",plugins:["chart"]},t))})),Object(w.jsx)("div",Object(s.a)({id:"luckysheet"},n))}),x),y=n(10),S=n(2),C=n(12),N=n.n(C),_=null,E=null,T=0,A=function(){var e,t=Object(S.f)(),n=t.filename,l=t.userid,c="ws://localhost:8080/ws?user="+l+"&path="+n,r="http://localhost:8080/read?user="+l+"&path="+n,a=N()(c),i=a.sendJsonMessage,u=a.lastMessage,d=a.readyState;Object(o.useMemo)((function(){if(console.log("lastMessage-----------------------------"),null!=u){var e,t=JSON.parse(u.data);switch(console.log(t),t.action){case"lock":if(console.log(t.user," lock ",t.sheet,"-",t.column,"-",t.row),t.user!==l){var n=window.luckysheet.getCellValue(t.row,t.column);e={},null!==n&&(e.v=n),e.bg="#808080",e.lock="1",window.luckysheet.setCellValue(t.row,t.column,e)}else _=t.row,E=t.column,console.log(_,E);break;case"unlock":if(console.log(t.user," unlock ",t.sheet,"-",t.column,"-",t.row),t.user!==l){var o=window.luckysheet.getCellValue(t.row,t.column);e={},null!==o&&(e.v=o),e.bg=null,e.lock=null,window.luckysheet.setCellValue(t.row,t.column,e)}else _=null,E=null;break;case"write":console.log(t.user," write ",t.sheet,"-",t.column,"-",t.row),(e=JSON.parse(t.updateData)).bg=null,e.lock=null,window.luckysheet.clearCell(t.row,t.column),window.luckysheet.setCellValue(t.row,t.column,e),t.user===l&&(_=null,E=null);break;default:console.log("other message")}}}),[u]);var h=(e={},Object(y.a)(e,C.ReadyState.CONNECTING,"Connecting"),Object(y.a)(e,C.ReadyState.OPEN,"Open"),Object(y.a)(e,C.ReadyState.CLOSING,"Closing"),Object(y.a)(e,C.ReadyState.CLOSED,"Closed"),Object(y.a)(e,C.ReadyState.UNINSTANTIATED,"Uninstantiated"),e)[d],g=function(){console.log("update before------------------------------"),1===T&&(T=0);for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];console.log(t)},j=function(){console.log("cell updated------------------------------");for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];console.log(t),console.log(_,E),"1"!==t[3].lock&&_===t[0]&&E===t[1]&&(console.log("send write message"),i(b.apply(void 0,t)))},b=function(){var e={action:"write",sheet:0};return e.column=arguments.length<=1?void 0:arguments[1],e.row=arguments.length<=0?void 0:arguments[0],e.user=l,e.path=n,e.updateData=JSON.stringify(arguments.length<=3?void 0:arguments[3]),console.log(e),e},f=function(){console.log("rangeSelect---------------------------"),1===T&&(T=0,console.log("cancel"),i(O.apply(void 0,arguments)))},O=function(){for(var e={action:"unlock",sheet:0},t=arguments.length,o=new Array(t),c=0;c<t;c++)o[c]=arguments[c];return e.column=o[1][0].column[0],e.row=o[1][0].row[0],e.user=l,e.path=n,console.log(e),e},m=function(){console.log("cellEditBefore---------------------------");for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];console.log("column: ",t[0][0].column[0]),console.log("row: ",t[0][0].row[0]),i(v.apply(void 0,t)),T=1},v=function(){for(var e={action:"lock",sheet:0},t=arguments.length,o=new Array(t),c=0;c<t;c++)o[c]=arguments[c];return e.column=o[0][0].column[0],e.row=o[0][0].row[0],e.user=l,e.path=n,console.log(e),e};console.log("Connection------------------------------: "+h);for(var p=arguments.length,x=new Array(p),A=0;A<p;A++)x[A]=arguments[A];return Object(w.jsx)(w.Fragment,{children:Object(w.jsx)(k,Object(s.a)({options:{data:null,myFolderUrl:"/",loadUrl:r,title:n,gridKey:n,hook:{cellUpdateBefore:g,cellUpdated:j,rangeSelect:f,cellEditBefore:m}},className:"sheet-fullpage"},x))})},R=n(39),D=function(){return Object(w.jsx)("div",{className:"bg-gray-100 min-h-screen h-full w-screen p-4",children:Object(w.jsx)("div",{className:"h-100 w-9/12 my-auto mx-auto flex items-center justify-center align-center font-sans",children:Object(w.jsx)(p,{})})})};var L=function(){return Object(w.jsx)(R.a,{children:Object(w.jsxs)(S.c,{children:[Object(w.jsx)(S.a,{path:"/sheet/:filename/:userid",children:Object(w.jsx)(A,{})}),Object(w.jsx)(S.a,{path:"/",children:Object(w.jsx)(D,{})})]})})},P=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,78)).then((function(t){var n=t.getCLS,o=t.getFID,l=t.getFCP,c=t.getLCP,r=t.getTTFB;n(e),o(e),l(e),c(e),r(e)}))};r.a.render(Object(w.jsx)(l.a.StrictMode,{children:Object(w.jsx)(L,{})}),document.getElementById("root")),P()}},[[77,1,2]]]);
//# sourceMappingURL=main.9755a2bd.chunk.js.map